# å¿«é€Ÿå…¥é—¨æŒ‡å—

## ä¸€åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ ç¼–è¯‘æµ‹è¯•

```bash
cd /Users/min.yang/learncode/flux/src/ag_gemm/test
./build_test.sh
```

### 2ï¸âƒ£ è¿è¡Œæµ‹è¯•

```bash
./run_test.sh
```

å°±è¿™ä¹ˆç®€å•ï¼

---

## ğŸ¯ è¿™ä¸ªæµ‹è¯•åšä»€ä¹ˆï¼Ÿ

æµ‹è¯• **AllGather + GEMM** èåˆæ“ä½œçš„æ€§èƒ½ï¼Œè¿™æ˜¯å¤§æ¨¡å‹è®­ç»ƒä¸­çš„å…³é”®æ“ä½œã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

- âœ… è‡³å°‘ 8 ä¸ª GPUï¼ˆå¯ä¿®æ”¹ TP å‚æ•°è°ƒæ•´ï¼‰
- âœ… GPU æ”¯æŒ P2P è®¿é—®
- âœ… CUDA å·²å®‰è£…

## ğŸ”§ è‡ªå®šä¹‰å‚æ•°

### ç¤ºä¾‹ 1: ä½¿ç”¨ 4 ä¸ª GPU

```bash
./run_test.sh 2048 10240 40960 4
```

### ç¤ºä¾‹ 2: æ›´å¤šè¿­ä»£ï¼ˆæ›´ç²¾ç¡®çš„æ€§èƒ½æµ‹é‡ï¼‰

```bash
./run_test.sh 2048 10240 40960 8 1 10 100
#                                     â†‘  â†‘
#                                  warmup iters
```

### ç¤ºä¾‹ 3: è°ƒè¯•æ¨¡å¼

```bash
./run_test.sh 2048 10240 40960 8 1 2 2 0 0 1
#                                          â†‘
#                                        debug=1
```

## ğŸ“Š ç†è§£è¾“å‡º

```
=== AG+GEMM Test Configuration ===
M=2048, N=10240, K=40960          â† çŸ©é˜µç»´åº¦
TP=8, NNodes=1                    â† å¹¶è¡Œé…ç½®
===================================
flux AG+GEMM #0: gemm 2.345 ms, comm 0.000 ms, total 2.345 ms
flux AG+GEMM #1: gemm 2.347 ms, comm 0.000 ms, total 2.347 ms
...
âœ… AG+GEMM test completed successfully
```

- **gemm time**: è®¡ç®—æ—¶é—´
- **comm time**: é€šä¿¡æ—¶é—´ï¼ˆé€šå¸¸ä¸º 0ï¼Œå› ä¸ºé€šä¿¡ä¸è®¡ç®—é‡å ï¼‰
- **total time**: æ€»æ—¶é—´

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### GPU æ•°é‡ä¸å¤Ÿï¼Ÿ

```bash
# ä½¿ç”¨æ›´å°‘çš„ GPU
./run_test.sh 2048 10240 40960 2  # ä»…éœ€ 2 ä¸ª GPU
```

### å†…å­˜ä¸å¤Ÿï¼Ÿ

```bash
# ä½¿ç”¨æ›´å°çš„çŸ©é˜µ
./run_test.sh 1024 4096 8192 8
```

### ç¼–è¯‘å¤±è´¥ï¼Ÿ

```bash
# æ£€æŸ¥ç¯å¢ƒ
echo $CUDA_HOME
nvcc --version

# æ¸…ç†é‡æ–°ç¼–è¯‘
cd /Users/min.yang/learncode/flux
rm -rf build
./build_test.sh
```

## ğŸ“š æ›´å¤šä¿¡æ¯

- è¯¦ç»†ä½¿ç”¨: `README.md`
- Python å¯¹æ¯”: `COMPARISON.md`
- æ–‡ä»¶æ€»ç»“: `SUMMARY.md`

## ğŸ“ å‚æ•°é€ŸæŸ¥è¡¨

```bash
./run_test.sh M N K TP NNODES WARMUP ITERS TRANSPOSE BIAS DEBUG
              â†“ â†“ â†“ â†“    â†“      â†“      â†“       â†“      â†“    â†“
           çŸ©é˜µç»´åº¦ å¹¶è¡Œ  èŠ‚ç‚¹   é¢„çƒ­   è¿­ä»£   è½¬ç½®æƒé‡ åç½® è°ƒè¯•
```

**é»˜è®¤å€¼**: 2048 10240 40960 8 1 5 10 0 0 0

## âœ¨ æç¤º

1. **é¦–æ¬¡è¿è¡Œ**: ä½¿ç”¨è°ƒè¯•æ¨¡å¼éªŒè¯ `./run_test.sh 1024 4096 8192 2 1 2 2 0 0 1`
2. **æ€§èƒ½æµ‹è¯•**: å¢åŠ è¿­ä»£æ¬¡æ•° `./run_test.sh ... 1 20 200`
3. **å¤šèŠ‚ç‚¹**: è®¾ç½® nnodes å‚æ•°ï¼ˆå®éªŒæ€§ï¼‰

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ `README.md` çš„æ•…éšœæ’é™¤éƒ¨åˆ†

